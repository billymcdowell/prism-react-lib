import{j as c}from"./jsx-runtime-u17CrQMm.js";import{c as G}from"./utils-CDN07tui.js";import{r as e}from"./iframe-B1FMP7ev.js";function H({textStream:n,speed:p=20,mode:R="typewriter",onComplete:M,fadeDuration:o,segmentDelay:w,characterChunkSize:x,onError:C}){const[j,l]=e.useState(""),[g,k]=e.useState(!1),[A,S]=e.useState([]),m=e.useRef(p),f=e.useRef(R),y=e.useRef(0),r=e.useRef(null),T=e.useRef(o),u=e.useRef(w),d=e.useRef(x),q=e.useRef(null),v=e.useRef(!1),N=e.useRef(M);e.useEffect(()=>{m.current=p,f.current=R,T.current=o,u.current=w,d.current=x},[p,R,o,w,x]),e.useEffect(()=>{N.current=M},[M]);const V=e.useCallback(()=>{if(typeof d.current=="number")return Math.max(1,d.current);const t=Math.min(100,Math.max(1,m.current));return f.current==="typewriter"?t<25?1:Math.max(1,Math.round((t-25)/10)):(f.current==="fade",1)},[]),L=e.useCallback(()=>{if(typeof u.current=="number")return Math.max(0,u.current);const t=Math.min(100,Math.max(1,m.current));return Math.max(1,Math.round(100/Math.sqrt(t)))},[]),J=e.useCallback(()=>{if(typeof T.current=="number")return Math.max(10,T.current);const t=Math.min(100,Math.max(1,m.current));return Math.round(1e3/Math.sqrt(t))},[]),P=e.useCallback(()=>{if(typeof u.current=="number")return Math.max(0,u.current);const t=Math.min(100,Math.max(1,m.current));return Math.max(1,Math.round(100/Math.sqrt(t)))},[]),I=e.useCallback(t=>{if(f.current==="fade")try{const s=new Intl.Segmenter(navigator.language,{granularity:"word"}).segment(t),a=Array.from(s).map((b,z)=>({text:b.segment,index:z}));S(a)}catch(i){const s=t.split(/(\s+)/).filter(Boolean).map((a,b)=>({text:a,index:b}));S(s),C?.(i)}},[]),h=e.useCallback(()=>{v.current||(v.current=!0,k(!0),N.current?.())},[]),E=e.useCallback(()=>{y.current=0,l(""),S([]),k(!1),v.current=!1,r.current&&(cancelAnimationFrame(r.current),r.current=null)},[]),F=e.useCallback(t=>{let i=0;const s=a=>{const b=L();if(b>0&&a-i<b){r.current=requestAnimationFrame(s);return}if(i=a,y.current>=t.length){h();return}const z=V(),$=Math.min(y.current+z,t.length),B=t.slice(0,$);l(B),f.current==="fade"&&I(B),y.current=$,$<t.length?r.current=requestAnimationFrame(s):h()};r.current=requestAnimationFrame(s)},[L,V,I,h]),_=e.useCallback(async t=>{const i=new AbortController;q.current=i;let s="";try{for await(const a of t){if(i.signal.aborted)return;s+=a,l(s),I(s)}h()}catch(a){console.error("Error processing text stream:",a),h(),C?.(a)}},[I,h,C]),D=e.useCallback(()=>{E(),typeof n=="string"?F(n):n&&_(n)},[n,E,F,_]),W=e.useCallback(()=>{r.current&&(cancelAnimationFrame(r.current),r.current=null)},[]),X=e.useCallback(()=>{typeof n=="string"&&!g&&F(n)},[n,g,F]);return e.useEffect(()=>(D(),()=>{r.current&&cancelAnimationFrame(r.current),q.current&&q.current.abort()}),[n,D]),{displayedText:j,isComplete:g,segments:A,getFadeDuration:J,getSegmentDelay:P,reset:E,startStreaming:D,pause:W,resume:X}}function K({textStream:n,mode:p="typewriter",speed:R=20,className:M="",onComplete:o,as:w="div",fadeDuration:x,segmentDelay:C,characterChunkSize:j}){const l=e.useRef(null),{displayedText:g,isComplete:k,segments:A,getFadeDuration:S,getSegmentDelay:m}=H({textStream:n,speed:R,mode:p,onComplete:o,fadeDuration:x,segmentDelay:C,characterChunkSize:j});e.useEffect(()=>{l.current=o??null},[o]);const f=e.useCallback(()=>{l.current&&k&&l.current()},[k]),y=`
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .fade-segment {
      display: inline-block;
      opacity: 0;
      animation: fadeIn ${S()}ms ease-out forwards;
    }

    .fade-segment-space {
      white-space: pre;
    }
  `,r=()=>{switch(p){case"typewriter":return c.jsx(c.Fragment,{children:g});case"fade":return c.jsxs(c.Fragment,{children:[c.jsx("style",{children:y}),c.jsx("div",{className:"relative",children:A.map((u,d)=>{const q=/^\s+$/.test(u.text),v=d===A.length-1;return c.jsx("span",{className:G("fade-segment",q&&"fade-segment-space"),style:{animationDelay:`${d*m()}ms`},onAnimationEnd:v?f:void 0,children:u.text},`${u.text}-${d}`)})})]});default:return c.jsx(c.Fragment,{children:g})}},T=w;return c.jsx(T,{className:M,children:r()})}K.__docgenInfo={description:"",methods:[],displayName:"ResponseStream",props:{textStream:{required:!0,tsType:{name:"union",raw:"string | AsyncIterable<string>",elements:[{name:"string"},{name:"AsyncIterable",elements:[{name:"string"}],raw:"AsyncIterable<string>"}]},description:""},mode:{required:!1,tsType:{name:"union",raw:'"typewriter" | "fade"',elements:[{name:"literal",value:'"typewriter"'},{name:"literal",value:'"fade"'}]},description:"",defaultValue:{value:'"typewriter"',computed:!1}},speed:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"20",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}},onComplete:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},as:{required:!1,tsType:{name:"React.JSX.IntrinsicElements"},description:"",defaultValue:{value:'"div"',computed:!1}},fadeDuration:{required:!1,tsType:{name:"number"},description:""},segmentDelay:{required:!1,tsType:{name:"number"},description:""},characterChunkSize:{required:!1,tsType:{name:"number"},description:""}}};export{K as R,H as u};
